Live Rails MVC Application and Scaffold
=======================================

Rails用一句命令，就可以生成一个可用的rails应用程序

    $ rails new rails-basics

模型 视图 控制器
---------------------

HTTP请求通过在`config/routes.rb`里定义的路由，被发送到对应的*controller*。一个控制器是一个继承自‘ApplicationController’的类，而后者继承自‘ActionController::Base’。
一般来说，这个控制器会去渲染一个相应的*view*，它是一个用ERB或者HAML或者其他格式写的模板，之后就会转换为HTML。这些模板经常用到一个特别的*layout*。这个视图经常包含着*model*从数据库得到的数据、

An Integration Test
-------------------

创造一个新的测试。

    rails generate integration_test index

这条语句在`test/integration/index_test.rb`里创建了一个测试。我们可以添加一些干货进去，验证我们可以给index.html渲染一个合适的title。

``` ruby
require 'test_helper'

class IndexTest < ActionDispatch::IntegrationTest
  fixtures :all

  test "fetches the index.html page" do
    get "/"
    assert_response :success
    assert_select "title", "Ruby on Rails: Welcome aboard"
  end

end
```

Asserts来自[ActionDispatch::Assertions](http://apidock.com/rails/ActionDispatch/Assertions)。

用命令‘rake test’来运行测试。

从SQL-Lite 换到 PostgreSQL
----------------------------------

Heroku不支持SQLLite。让我们换到PostgreSQL。

在Gemfile里面把sqlite换成pg，然后运行bundle install、

创建一个登陆角色

    $ psql template1  

    create role rails with createdb login password 'password';

编辑 `config/database.yml`.

``` yaml
common: &common
  adapter: postgresql
  username: rails
  password: password
  host: localhost
  port: 5432

development:
  <<: *common
  database: rails_development

test:
  <<: *common
  database: rails_test

production:
  <<: *common
  database: rails_production
```

Create the databases.

    rake db:create:all

Assets
------

在Rails，assets是预先编译的。

    RAILS_ENV=production
    rake assets:precompile
    git add public/assets
    git commit -m "vendor compiled assets"

部署到Heroku
----------------

Heroku提供了基于git的部署工作流式的Rails应用hosting服务。到这里创建一个新的账号[heroku.com](http://www.heroku.com/)、

    gem install heroku
    heroku keys:add

创建一个应用程序。

    $ heroku create dblock-rails-mvc --stack cedar
    Creating dblock-rails-mvc... done, stack is cedar
    http://dblock-rails-mvc.herokuapp.com | git@heroku.com:dblock-rails-mvc.git

设置一个远程*heroku* repo。这是一个基于Git的目标，我们可以*push*代码到里面。你可以通过命令‘git remote -v’查看你的远程资源列表。

    $ git remote add heroku git@heroku.com:dblock-rails-mvc.git

把应用程序推到heroku。

    $ git push heroku master

打开一个浏览器，输入命令`heroku open`.

Scaffold 领域模型
---------------------

    rails generate scaffold Thing name:string description:string

这条语句可以创造一个模型、一个控制器、一些视图、一个数据库迁移脚本、更新schema和一些基本的测试。

Rakefile
--------

任务用Ruby来写，用[Rake](https://github.com/jimweirich/rake)来运行。Rake需要一个‘Rakefile’导入应用的代码.你可以运行`rake -T`来查看有哪些可用的任务。

    $ rake -T
    rake about # List versions of all Rails frameworks and the environment
    ...

练 习
--------

在`lib/tasks`创建一个Rake任务来载入`database.yaml`文件，并显示出目前环境下数据库的配置。当运行任务时，检查下数据库值是否已经设置了的。你可能需要设置 YAML::ENGINE.yamler = 'syck'

Next
====

Lets rebuild a [Rails MVC application from scratch](4.3-rails-mvc-dev.md).

