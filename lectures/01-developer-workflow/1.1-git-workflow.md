Git引言
===================

目 标
---------

学习Git的基础知识，并且理解在Ruby和Ruby on Rails的生态系统种，Github在扮演什么样的角色。学习更多的概念，比如*snapshot*, *repository*, *pull*, *push* and *topical branches*、

Git
---

Git是一个开源的很快的分布式版本控制系统。和CVS、SourceSafe, ClearCase, Subversion 或者 Perforce不一样，但有点像Mercurial。分布式意思是它可以离线工作。Git是Ruby和Ruby on Rails生态系统必要的一环。

Git 快照
-------------

一个git的commit是所有文件和元信息在给定时间的快照，而不是文件的差别。

一个新的Git Repository
--------------------

离线创造一个GIT repostory。我们管这个叫*red*.

    $ mkdir ga
    $ cd ga
    ga$ mkdir red
    ga$ cd red

    ga/red$ git init
    Initialized empty Git repository in /home/dblock/sourcega/red/.git/

    ga/red$ touch README.md

    ga/red$ git add README.md

    ga/red$ git status

    # On branch master
    #
    # Initial commit
    #
    # Changes to be committed:
    #   (use "git rm --cached <file>..." to unstage)
    #
    #	new file:   README.md
    #

    ga/red$ git commit -m "Added README."
    [master (root-commit) 3923738] Added README.
     0 files changed, 0 insertions(+), 0 deletions(-)
     create mode 100644 README.md

    ga/red$ 

练习
--------

修改*README.md*里的内容，以[Markdown](http://daringfireball.net/projects/markdown/syntax)里的格式提交变更的。

我们的本地Repository
---------------------------

在我们的*本地* repository里，我们之前的commit替换了我们的变更，这是一个在Git和Hg这样的分布式版本管理系统里独有的概念。

验证*本地* repository的提交历史.

    ga/red$ git log

    commit 392373835e0f7702251d45a088664918e9125c97
    Author: dblock
    Date:   Mon Dec 5 09:34:08 2011 -0500

    Added README.

推送到一个远程的Repository: Github
-----------------

[在Github上创建一个新的repository](https://github.com/repositories/new)，叫*red*. 这是一个没有文件的空repository. Github会在他们自己的服务器上运行像我们刚才运行的那样的命令。

We can connect our local *red* repository with Github's by adding a remote location called *origin*. This name is just a convention.

    ga/red$ git remote add origin git@github.com:<username>/red.git

One can now see the remote branch listed:

    ga/red$ git remote
    origin

Push all our changes to Github.

    ga/red$ git push -u origin master

Next time you can push all pending changes on all branches.

    ga/red$ git push

The opposite of *pushing* is *pulling*. The following updates the local copy to the remote changes on the *master* branch.

    ga/red$ git pull origin master 

Cloning
-------

Use `git clone` to get a copy of an existing Github repository to your local machine.

    ga$ git clone git@github.com:<username>/red.git green

This creates a new folder called *green* with the contents of the *red* repository, a *local* repository from the *remote* repository on github.

Topic Branches
----------------

Unlike other source controls, branches are cheap. In Git it's considered a good practice to never work on the *master* branch and create *topic branches* instead. A topic branch is created off master.

First, list your branches. You will see that you are on the *master* branch.

    ga/red$ git branch

Ensure the *master* branch is up-to-date.

    ga/red$ git pull origin master 

Create a new branch *readme-changes*.

    ga/red$ git checkout -b readme-changes
    Switched to a new branch 'readme-changes'

    ga/red$ git status
    # On branch readme-changes
    nothing to commit (working directory clean)

Make some changes on the branch, commit them and push them to Github.

    ga/red$ git push origin readme-changes

When the feature on a branch is ready, merge it to *master*.

    ga/red$ git checkout master
    ga/red$ git merge readme-changes

Visualize the Branches
-------------------

Commits add to the log inside Git, allowing one to visualize the changes to each particular branch.

    ga/red$ git log --graph

Use the built-in GUI GitK to see this graph

    ga/red$ gitk

Exercise
--------

Make a change to README in your local *red* repository in a new branch, *push* it to Github and *pull* the branch into your local *green* copy.

Forking
-------

To contribute to someone else's work, create a new *fork* via Github, then clone your fork to your local environment. To submit changes, make *pull requests*.

To pull changes made to the original work, one would need to set up an `upstream` remote repository.

    ga/red$ git remote add upstream git@github.com:<original_author>/<upstream_source>.git

    ga/red$ git remote
    origin
    upstream

To pull any changes made to upstream one would run the following command:

    ga/red$ git pull upstream master

Exercise
--------

In pairs, fork each-other's repositories, clone your fork, make a change to *README.md* and create a pull request. Examine the difference on Github and merge the pull request. Extra points for creating a topic branch.

