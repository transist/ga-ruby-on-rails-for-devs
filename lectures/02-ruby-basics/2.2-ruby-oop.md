Ruby 对象
============

基 础 类
-----------

所有的类都继承自'Object'，你可以从其他的类继承。

``` ruby
class Color
  def initialize(name = nil)
    @name = name
  end
  def name=(value)
    @name = value
  end
  def name
    @name
  end
end
```

用‘new’就可以创建一个实例，而且会自动被垃圾回收。

``` ruby
puts Color.new.inspect # <Color: @name=nil>
puts Color.new("red").inspect # <Color: @name="red">
```

异 常
----------

异常可能是`RuntimeError < StandardError < Exception` types. The shortcut for `raise 'error!'`，制造了一个`RuntimeError`。

``` ruby
begin
  raise "error!"
rescue Exception => e
  puts e.inspect # #<RuntimeError: error!>
end
```

异常可以被抓住，然后再试一次。

``` ruby
count = 1
begin
  raise BadError.new("error!") if count <= 2
rescue Exception => e
  count += 1
  puts e.inspect # #<BadError: error!> (twice)
  retry
end
```

混入（Mixins)
------

你用‘include’就可以混合实例方法到另一个类中.

``` ruby
module Incrementable
  def increment
    self.to_i + 1
  end
end

module Decrementable
  def decrement
    self.to_i - 1
  end
end

class Number
  include Incrementable
  include Decrementable

  attr_reader :value

  def initialize(value)
    @value = value
  end

  def to_i
    @value.to_i
  end

end

n = Number.new(5)
puts n.increment # 6
puts n.decrement # 4
```

混入提升了比继承更好的构成代码的方式。

Monkey Patching
---------------

方法，类，变量和其他的所有的东西都是在载入时被定义的，你可以在Ruby里*monkey-patch*所有的类。

``` ruby
class Number
  def to_i
    @value.to_i + 10
  end
end

puts n.increment # 16
puts n.decrement # 14
```

力量越大，责任越大
With great power comes great responsibility.

反射
----------

Ruby的反射是内建的。在运行的时候可以定义方法。你可以选择使用monkey-patch一个类，或者打开一个类，对私有的声明进行一些工作。

``` ruby
Color.methods
Color.new.methods

# Color.define_method :shine, lambda { "shiny #{name}" } - illegal, define_method is private
Color.send(:define_method, :shine, lambda { "shiny #{name}" })
puts Color.new("red").shine # shiny red

Color.new.is_a?(Color) # true
```

练 习
--------

把一个`squared_euclidean_distance`方法加入到‘Hash’类中，这个方法以另外一个‘Hash’对象作为参数，然后计算出欧几里得平方距离。‘{ :x => 1, :y => 2 }’和‘{ :x => 3, :y => 4 }’之间的欧几里得平方距离是‘(1 - 3)**2 + (2 - 4)**2’。

``` ruby
puts ( {}.squared_euclidean_distance({}) ) # 0
puts ( { :x => 2, :y => 3 }.squared_euclidean_distance({ :y => 4, :x => 5 }) ) # 10
puts ( { :x => 10, :y => 20 }.squared_euclidean_distance({}) ) # 500
puts ( {}.squared_euclidean_distance({ :x => 10, :y => 20 }) ) # 500
```

