NoSQL 基础
============

NoSQL是一类不使用SQL语言来查询的数据库。今天我们来从“不只是SQL(Not only SQL)”的角度来谈谈NoSQL。

SQL 反模式
----------------

从[这个演示](http://www.slideshare.net/gleicon/nosql-introduction)得出的结论：

* Threaded Discussions: 在同一张表内指向其他行的行。rows referring to other rows in the same table
* Dynamic Tables: 创建一张及时的表。create a table "on-the-fly"
* Padded Columns: 在我们需要的时候添加几列。add a few columns that we will need soon
* Stored Procedures: 我们没法记住的创建数据的副作用。data creation side-effects that we can't remember
* Tables as Cache: 各种临时对象的不同类型。different types of temporary objects
* Tables as Queue: 各种处理过程的不同对象类型。different types of objects queued for processing
* Lengthy JOINs: 应用程序需要热身。application requires warmup
* Huge Schema: 你需要大量的JOIN，太复杂了。so complicated you need huge JOINs
* ORM Madness: 许多SQL把数据转换进入到对象模型。lots of SQL that converts data into an object model

NoSQL Stores
------------

根据[nosql-database.org](http://nosql-database.org)，目前已知的有122种NoSQL数据库。

* Wide Column: Hadoop, Cassandra, Amazon SimpleDB
* Document: MongoDB, CouchDB, Lotus Notes
* Key-Value: Redis, Riak
* Graph: Neo4J
* Object: Versant, Sterling
* XML: Marklogic

CAP
---

三者不能兼得，选两个吧。

* Consistency一致性: 所有的客户端都一直持有数据相同的视图。
* Availability可用性: 每一个客户端都一直可以读写。
* Partition Tolerance分区容错性: 系统不受物理网络分区影响，工作正常。

MongoDB
-------

按照[这里](http://www.mongodb.org/display/DOCS/Quickstart)的说明来安装MongoDB.

MongoDB是一个持久化保存JSON文档的*文档存储*。

    $ mongo
    MongoDB shell version: 2.0.2
    connecting to: test
    > show dbs
    local	(empty)

切换到*demo*数据库。这个数据库会自动生成。

    > use demo
    switched to db demo

插入一个文档到*things*集合里面。

    > db.things.save({name : "first thing", description : "second thing"});

显示所有的集合。

    > show collections
    system.indexes
    things

显示*things*的第一条记录。

    > db.things.findOne()
    {
	    "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0"),
	    "name" : "first thing",
	    "description" : "second thing"
    }

保存另外一个文档，然后把它们俩都找出来。

    > db.things.save({name : "second thing", description : "second thing"});
    > db.things.find()
    { "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0"), "name" : "first thing", "description" : "second thing" }
    { "_id" : ObjectId("4f3bba03b47d69a700f9d4a1"), "name" : "second thing", "description" : "second thing" }

通过ID来找到一个文档。

    > db.things.find({ "_id" : ObjectId("4f3bba03b47d69a700f9d4a1") })
    { "_id" : ObjectId("4f3bba03b47d69a700f9d4a1"), "name" : "second thing", "description" : "second thing" }

移除一个文档。

    > db.things.remove({ "_id" : ObjectId("4f3bba03b47d69a700f9d4a1")})

更新一个文档会替换该文档所有的数据。

    > db.things.update({ "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0")}, { "name" : "updated thing" })
    > db.things.find()
    { "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0"), "name" : "updated thing" }

用*$set*来设一个值。

    > db.things.update({ "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0")}, { "$set" : { "description" : "updated description" }})
    > db.things.find()
    { "_id" : ObjectId("4f3bb9a7b47d69a700f9d4a0"), "description" : "updated description", "name" : "updated thing" }

